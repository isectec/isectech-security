# iSECTECH Moloch/Arkime Configuration
# Production-grade packet capture and analysis configuration

[default]
# ═══════════════════════════════════════════════════════════════════════════════
# ELASTICSEARCH CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

# Primary Elasticsearch cluster
elasticsearch=http://elasticsearch-01:9200,http://elasticsearch-02:9200,http://elasticsearch-03:9200

# Connection settings
elasticsearchTimeout=300
elasticsearchMaxConnsPerNode=20
elasticsearchMaxRetries=3

# Index configuration
rotateIndex=daily
deleteCheckDays=1
expireDays=30
optimizeAdminOnly=false

# Bulk operations
dbBulkSize=1000000
dbFlushTimeout=5

# Compression and storage
compressES=gzip
encryptS2disk=AES-256-CBC

# ═══════════════════════════════════════════════════════════════════════════════
# PACKET CAPTURE CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

# Network interfaces (will be overridden by environment variable)
interface=eth0;eth1;eth2;eth3

# Packet capture directories
pcapDir=/data/pcap/hot

# File management
maxFileSizeG=12
maxFileTimeM=120
pcapWriteMethod=thread
pcapWriteSize=262144

# Packet buffer settings
maxPackets=10000
packetThreads=8

# Network timeouts
icmpTimeout=10
udpTimeout=60
tcpTimeout=600
tcpSaveTimeout=720

# ═══════════════════════════════════════════════════════════════════════════════
# PROCESSING CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

# Protocol parsing
parseSMTP=true
parseSMB=true
parseQSValue=true
parseCookieValue=true
parseHTTPHeaderValue=true

# Content analysis
supportSha256=true
magicMode=libmagic-nodll

# Geo IP configuration
geoLite2Country=/usr/share/GeoIP/GeoLite2-Country.mmdb
geoLite2ASN=/usr/share/GeoIP/GeoLite2-ASN.mmdb

# ═══════════════════════════════════════════════════════════════════════════════
# SECURITY CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

# User management
dropUser=moloch
dropGroup=moloch

# Web interface security
passwordSecret=iSECTECH_Moloch_Secret_2024_Production
httpRealm=iSECTECH Moloch NSM

# HTTPS configuration
certFile=/etc/moloch/moloch.crt
keyFile=/etc/moloch/moloch.key
caTrustFile=/etc/ssl/certs/ca-certificates.crt

# Session management
sessionTimeout=3600

# ═══════════════════════════════════════════════════════════════════════════════
# PERFORMANCE TUNING
# ═══════════════════════════════════════════════════════════════════════════════

# Memory management
maxMemPercentage=50
freeSpaceG=100

# Database optimization
dbReadTimeout=120
dbBulkSize=1000000
dbFlushTimeout=5

# Network optimization
packetThreads=8
maxPacketsInQueue=500000

# ═══════════════════════════════════════════════════════════════════════════════
# WISE (THREAT INTELLIGENCE) CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

# WISE integration
wiseHost=wise.isectech.local
wisePort=8081
wiseCacheSecs=600

# Threat intelligence sources
wise.sources=alienvault;virustotal;threatfox

# ═══════════════════════════════════════════════════════════════════════════════
# LOGGING CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

# Log files
logDir=/var/log/moloch
logFileCreation=daily

# Debug settings
debug=0
insecure=false

# ═══════════════════════════════════════════════════════════════════════════════
# CLUSTER CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

# Cluster name for this deployment
cluster=iSECTECH-Production

# Node identification (overridden by environment)
nodeClass=capture

# Load balancing
multiES=true
multiESTimeout=30

# ═══════════════════════════════════════════════════════════════════════════════
# PLUGIN CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

# Plugin directories
pluginsDir=/data/moloch/plugins

# Enabled plugins
plugins=wise.so;reader-libpcap.so

# Plugin-specific configuration
parsersDir=/data/moloch/parsers

# ═══════════════════════════════════════════════════════════════════════════════
# FIELD DEFINITIONS AND CUSTOM FIELDS
# ═══════════════════════════════════════════════════════════════════════════════

# Custom field definitions for iSECTECH
field.threat-score;kind:integer;friendly:Threat Score;db:threatScore;help:iSECTECH threat intelligence score (0-100)
field.risk-level;kind:termfield;friendly:Risk Level;db:riskLevel;help:Risk classification (low, medium, high, critical)
field.geo-threat;kind:termfield;friendly:Geographic Threat;db:geoThreat;help:Geographic risk indicators
field.ioc-match;kind:termfield;friendly:IOC Match;db:iocMatch;help:Threat intelligence IOC matches
field.behavior-score;kind:integer;friendly:Behavior Score;db:behaviorScore;help:Behavioral analysis score
field.compliance-tag;kind:termfield;friendly:Compliance Tag;db:complianceTag;help:Compliance-related classification

# ═══════════════════════════════════════════════════════════════════════════════
# VIEWER SPECIFIC CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

# Web interface settings
viewPort=8005
viewHost=0.0.0.0

# User interface
timezone=UTC
downloadPcap=true
uploadPcap=false

# Search and query settings
maxReqBody=20971520
queryTimeout=120
huntTimeout=600

# Multi-viewer configuration
multiViewer=false

# ═══════════════════════════════════════════════════════════════════════════════
# CAPTURE SPECIFIC CONFIGURATION  
# ═══════════════════════════════════════════════════════════════════════════════

# Capture optimization
snapLen=16384
maxFileTimeM=120
readTruncatedPackets=false

# Network configuration
bpf=
dontSaveBPFs=false

# Memory mapped files
pcapReadMethod=tpacketv3

# High performance settings
tpacketv3NumThreads=2
tpacketv3BlockSize=8388608
tpacketv3BlockTimeout=10

# ═══════════════════════════════════════════════════════════════════════════════
# ANTI-VIRUS AND MALWARE DETECTION
# ═══════════════════════════════════════════════════════════════════════════════

# ClamAV integration
clamav=false
clamavSocket=/var/run/clamav/clamd.ctl

# Yara integration  
yara=true
yaraRulesDir=/etc/moloch/yara-rules

# ═══════════════════════════════════════════════════════════════════════════════
# SMTP AND EMAIL PARSING
# ═══════════════════════════════════════════════════════════════════════════════

# SMTP parsing configuration
parseSMTP=true
parseSMTPHeaderAll=true
smtpIpHeaders=X-Originating-IP;X-Barracuda-Apparent-Source-IP

# Email attachment processing
emailSaveLimit=1048576
emailParseSaveLimit=10485760

# ═══════════════════════════════════════════════════════════════════════════════
# HTTP AND WEB TRAFFIC ANALYSIS
# ═══════════════════════════════════════════════════════════════════════════════

# HTTP parsing
parseHTTP=true
parseHTTPHeaderValue=true
httpBodyMagic=true

# Cookie and query string parsing
parseCookieValue=true
parseQSValue=true

# HTTP request/response limits
httpSaveLimit=1048576
httpParseSaveLimit=10485760

# ═══════════════════════════════════════════════════════════════════════════════
# SSL/TLS AND CERTIFICATE ANALYSIS
# ═══════════════════════════════════════════════════════════════════════════════

# Certificate parsing
parseSSHKey=true
parseSSL=true

# Certificate validation
certValidateHostnames=true
certSaveBody=true

# JA3/JA3S fingerprinting (handled by Zeek integration)
ja3=true

# ═══════════════════════════════════════════════════════════════════════════════
# INTEGRATION WITH OTHER SYSTEMS
# ═══════════════════════════════════════════════════════════════════════════════

# Kafka integration for real-time streaming
kafka=true
kafkaBrokers=kafka-1.isectech.local:9092,kafka-2.isectech.local:9092
kafkaTopic=moloch-sessions
kafkaCompression=gzip

# Redis integration for caching
redis=true
redisURL=redis://redis-capture-cache:6379/0

# Syslog integration
syslog=true
syslogHost=syslog.isectech.local
syslogPort=514

# ═══════════════════════════════════════════════════════════════════════════════
# ALERTING AND NOTIFICATIONS
# ═══════════════════════════════════════════════════════════════════════════════

# Real-time alerting
alerting=true
alertURL=http://capture-management-api:8080/api/alerts

# Webhook notifications
webhook=true
webhookURL=http://capture-management-api:8080/api/webhooks/moloch

# ═══════════════════════════════════════════════════════════════════════════════
# BACKUP AND ARCHIVAL
# ═══════════════════════════════════════════════════════════════════════════════

# Automatic archival
archiveOld=true
archiveDir=/data/pcap/warm

# Compression for archived data
archiveCompress=true
archiveCompressType=gzip

# ═══════════════════════════════════════════════════════════════════════════════
# DEVELOPMENT AND DEBUG SETTINGS
# ═══════════════════════════════════════════════════════════════════════════════

# Debug settings (production should be 0)
debug=0
debugESCalls=false
debugPackets=false

# Performance monitoring
profilePackets=false
profileES=false

# Test and development
dryRun=false
tests=false