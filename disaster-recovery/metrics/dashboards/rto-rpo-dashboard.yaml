# iSECTECH RTO/RPO Monitoring Dashboard Configuration
# Grafana dashboard for real-time disaster recovery metrics visualization

apiVersion: v1
kind: ConfigMap
metadata:
  name: rto-rpo-dashboard
  namespace: isectech-monitoring
  labels:
    app.kubernetes.io/name: rto-rpo-dashboard
    app.kubernetes.io/instance: isectech
    grafana_dashboard: "1"
data:
  dashboard.json: |
    {
      "dashboard": {
        "id": null,
        "title": "iSECTECH - RTO/RPO Disaster Recovery Metrics",
        "tags": ["disaster-recovery", "rto", "rpo", "sla"],
        "style": "dark",
        "timezone": "UTC",
        "refresh": "30s",
        "time": {
          "from": "now-24h",
          "to": "now"
        },
        "timepicker": {
          "refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h"],
          "time_options": ["5m", "15m", "1h", "6h", "12h", "24h", "2d", "7d", "30d"]
        },
        "panels": [
          {
            "id": 1,
            "title": "Service Health Overview",
            "type": "stat",
            "gridPos": {
              "h": 8,
              "w": 24,
              "x": 0,
              "y": 0
            },
            "targets": [
              {
                "expr": "isectech_service_health_status",
                "refId": "A",
                "legendFormat": "{{service_name}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "none",
                "mappings": [
                  {"value": 1, "text": "HEALTHY", "color": "green"},
                  {"value": 0, "text": "UNHEALTHY", "color": "red"}
                ]
              }
            }
          },
          {
            "id": 2,
            "title": "Current RTO Status by Service",
            "type": "bargauge",
            "gridPos": {
              "h": 8,
              "w": 12,
              "x": 0,
              "y": 8
            },
            "targets": [
              {
                "expr": "isectech_service_rto_target_minutes",
                "refId": "A",
                "legendFormat": "RTO Target - {{service_name}}"
              },
              {
                "expr": "isectech_current_outage_duration_minutes",
                "refId": "B",
                "legendFormat": "Current Outage - {{service_name}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "m",
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": null},
                    {"color": "yellow", "value": 5},
                    {"color": "red", "value": 15}
                  ]
                }
              }
            }
          },
          {
            "id": 3,
            "title": "Current RPO Status by Service",
            "type": "bargauge",
            "gridPos": {
              "h": 8,
              "w": 12,
              "x": 12,
              "y": 8
            },
            "targets": [
              {
                "expr": "isectech_service_rpo_target_minutes",
                "refId": "A",
                "legendFormat": "RPO Target - {{service_name}}"
              },
              {
                "expr": "isectech_last_backup_age_minutes",
                "refId": "B",
                "legendFormat": "Last Backup Age - {{service_name}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "m",
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": null},
                    {"color": "yellow", "value": 15},
                    {"color": "red", "value": 60}
                  ]
                }
              }
            }
          },
          {
            "id": 4,
            "title": "RTO Compliance Rate (Last 30 Days)",
            "type": "piechart",
            "gridPos": {
              "h": 8,
              "w": 8,
              "x": 0,
              "y": 16
            },
            "targets": [
              {
                "expr": "sum(increase(isectech_rto_compliance_total[30d])) by (compliance_status)",
                "refId": "A",
                "legendFormat": "{{compliance_status}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "short",
                "mappings": [
                  {"value": "compliant", "text": "Compliant", "color": "green"},
                  {"value": "non_compliant", "text": "Non-Compliant", "color": "red"}
                ]
              }
            }
          },
          {
            "id": 5,
            "title": "RPO Compliance Rate (Last 30 Days)",
            "type": "piechart",
            "gridPos": {
              "h": 8,
              "w": 8,
              "x": 8,
              "y": 16
            },
            "targets": [
              {
                "expr": "sum(increase(isectech_rpo_compliance_total[30d])) by (compliance_status)",
                "refId": "A",
                "legendFormat": "{{compliance_status}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "short",
                "mappings": [
                  {"value": "compliant", "text": "Compliant", "color": "green"},
                  {"value": "non_compliant", "text": "Non-Compliant", "color": "red"}
                ]
              }
            }
          },
          {
            "id": 6,
            "title": "Mean Time to Recovery (MTTR) Trend",
            "type": "timeseries",
            "gridPos": {
              "h": 8,
              "w": 8,
              "x": 16,
              "y": 16
            },
            "targets": [
              {
                "expr": "rate(isectech_total_recovery_time_minutes[7d]) / rate(isectech_outage_count_total[7d])",
                "refId": "A",
                "legendFormat": "MTTR - {{service_name}}"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "m",
                "custom": {
                  "drawStyle": "line",
                  "lineInterpolation": "smooth"
                }
              }
            }
          },
          {
            "id": 7,
            "title": "Availability SLA Status",
            "type": "table",
            "gridPos": {
              "h": 8,
              "w": 12,
              "x": 0,
              "y": 24
            },
            "targets": [
              {
                "expr": "isectech_service_availability_target",
                "refId": "A",
                "format": "table"
              },
              {
                "expr": "isectech_service_actual_availability",
                "refId": "B",
                "format": "table"
              }
            ],
            "transformations": [
              {
                "id": "merge",
                "options": {}
              },
              {
                "id": "organize",
                "options": {
                  "excludeByName": {},
                  "indexByName": {},
                  "renameByName": {
                    "service_name": "Service",
                    "Value #A": "SLA Target (%)",
                    "Value #B": "Current Availability (%)"
                  }
                }
              }
            ],
            "fieldConfig": {
              "overrides": [
                {
                  "matcher": {"id": "byName", "options": "Current Availability (%)"},
                  "properties": [
                    {
                      "id": "thresholds",
                      "value": {
                        "steps": [
                          {"color": "red", "value": null},
                          {"color": "yellow", "value": 99.0},
                          {"color": "green", "value": 99.9}
                        ]
                      }
                    }
                  ]
                }
              ]
            }
          },
          {
            "id": 8,
            "title": "Business Impact Assessment",
            "type": "table",
            "gridPos": {
              "h": 8,
              "w": 12,
              "x": 12,
              "y": 24
            },
            "targets": [
              {
                "expr": "isectech_business_impact_revenue_loss_rate",
                "refId": "A",
                "format": "table"
              },
              {
                "expr": "isectech_business_impact_user_count",
                "refId": "B",
                "format": "table"
              }
            ],
            "transformations": [
              {
                "id": "merge",
                "options": {}
              },
              {
                "id": "organize",
                "options": {
                  "renameByName": {
                    "service_name": "Service",
                    "Value #A": "Revenue Loss Rate ($/min)",
                    "Value #B": "Affected Users"
                  }
                }
              }
            ]
          },
          {
            "id": 9,
            "title": "Critical Service Outage Timeline",
            "type": "timeseries",
            "gridPos": {
              "h": 8,
              "w": 24,
              "x": 0,
              "y": 32
            },
            "targets": [
              {
                "expr": "isectech_outage_active{criticality=\"CRITICAL\"}",
                "refId": "A",
                "legendFormat": "{{service_name}} Outage"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "none",
                "custom": {
                  "drawStyle": "bars",
                  "barAlignment": 0,
                  "fillOpacity": 80
                },
                "thresholds": {
                  "steps": [
                    {"color": "transparent", "value": null},
                    {"color": "red", "value": 1}
                  ]
                }
              }
            }
          },
          {
            "id": 10,
            "title": "Disaster Recovery Test Results",
            "type": "stat",
            "gridPos": {
              "h": 6,
              "w": 24,
              "x": 0,
              "y": 40
            },
            "targets": [
              {
                "expr": "isectech_dr_test_success_rate",
                "refId": "A",
                "legendFormat": "{{test_type}} Success Rate"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "min": 0,
                "max": 100,
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": null},
                    {"color": "yellow", "value": 80},
                    {"color": "green", "value": 95}
                  ]
                }
              }
            }
          }
        ],
        "annotations": {
          "list": [
            {
              "name": "RTO Breaches",
              "datasource": "Prometheus",
              "enable": true,
              "expr": "changes(isectech_rto_breach_total[1h]) > 0",
              "iconColor": "red",
              "titleFormat": "RTO Breach: {{service_name}}"
            },
            {
              "name": "RPO Breaches", 
              "datasource": "Prometheus",
              "enable": true,
              "expr": "changes(isectech_rpo_breach_total[1h]) > 0",
              "iconColor": "orange",
              "titleFormat": "RPO Breach: {{service_name}}"
            }
          ]
        },
        "templating": {
          "list": [
            {
              "name": "service",
              "type": "query",
              "query": "label_values(isectech_service_health_status, service_name)",
              "includeAll": true,
              "allValue": ".*"
            },
            {
              "name": "criticality",
              "type": "query", 
              "query": "label_values(isectech_service_health_status, criticality)",
              "includeAll": true,
              "allValue": ".*"
            }
          ]
        }
      }
    }

---
# Grafana Dashboard for Executive Summary
apiVersion: v1
kind: ConfigMap
metadata:
  name: rto-rpo-executive-dashboard
  namespace: isectech-monitoring
  labels:
    app.kubernetes.io/name: rto-rpo-executive-dashboard
    app.kubernetes.io/instance: isectech
    grafana_dashboard: "1"
data:
  dashboard.json: |
    {
      "dashboard": {
        "id": null,
        "title": "iSECTECH - Executive DR Summary",
        "tags": ["executive", "disaster-recovery", "summary"],
        "style": "dark",
        "timezone": "UTC",
        "refresh": "5m",
        "time": {
          "from": "now-30d",
          "to": "now"
        },
        "panels": [
          {
            "id": 1,
            "title": "Overall Disaster Recovery Health",
            "type": "stat",
            "gridPos": {
              "h": 6,
              "w": 6,
              "x": 0,
              "y": 0
            },
            "targets": [
              {
                "expr": "avg(isectech_service_health_status) * 100",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "min": 0,
                "max": 100,
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": null},
                    {"color": "yellow", "value": 95},
                    {"color": "green", "value": 99}
                  ]
                }
              }
            }
          },
          {
            "id": 2,
            "title": "RTO Compliance (30 Days)",
            "type": "stat",
            "gridPos": {
              "h": 6,
              "w": 6,
              "x": 6,
              "y": 0
            },
            "targets": [
              {
                "expr": "sum(increase(isectech_rto_compliance_total{compliance_status=\"compliant\"}[30d])) / sum(increase(isectech_rto_compliance_total[30d])) * 100",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": null},
                    {"color": "yellow", "value": 95},
                    {"color": "green", "value": 99}
                  ]
                }
              }
            }
          },
          {
            "id": 3,
            "title": "RPO Compliance (30 Days)",
            "type": "stat",
            "gridPos": {
              "h": 6,
              "w": 6,
              "x": 12,
              "y": 0
            },
            "targets": [
              {
                "expr": "sum(increase(isectech_rpo_compliance_total{compliance_status=\"compliant\"}[30d])) / sum(increase(isectech_rpo_compliance_total[30d])) * 100",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": null},
                    {"color": "yellow", "value": 95},
                    {"color": "green", "value": 99}
                  ]
                }
              }
            }
          },
          {
            "id": 4,
            "title": "Total Business Impact (30 Days)",
            "type": "stat",
            "gridPos": {
              "h": 6,
              "w": 6,
              "x": 18,
              "y": 0
            },
            "targets": [
              {
                "expr": "sum(increase(isectech_business_impact_total_loss[30d]))",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "unit": "currencyUSD",
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": null},
                    {"color": "yellow", "value": 10000},
                    {"color": "red", "value": 50000}
                  ]
                }
              }
            }
          }
        ]
      }
    }