# InfluxDB Configuration for iSECTECH Load Testing Metrics
# Optimized for high-throughput k6 metrics collection

# Global configuration
reporting-disabled = true
hostname = "influxdb-load-testing"

# Bind addresses
bind-address = "0.0.0.0:8088"

# Meta configuration
[meta]
  dir = "/var/lib/influxdb/meta"
  retention-autocreate = true
  logging-enabled = true

# Data configuration
[data]
  dir = "/var/lib/influxdb/data"
  wal-dir = "/var/lib/influxdb/wal"
  
  # Query logging
  query-log-enabled = true
  
  # Cache settings optimized for load testing metrics
  cache-max-memory-size = "1g"
  cache-snapshot-memory-size = "25m"
  cache-snapshot-write-cold-duration = "10m"
  
  # TSM Engine settings
  compact-full-write-cold-duration = "4h"
  compact-throughput = "48m"
  compact-throughput-burst = "64m"
  
  # WAL settings for high write throughput
  wal-fsync-delay = "0s"
  wal-segment-size = "10m"
  
  # Series limits
  max-series-per-database = 10000000
  max-values-per-tag = 100000

# Coordinator configuration
[coordinator]
  write-timeout = "30s"
  max-concurrent-queries = 100
  query-timeout = "60s"
  log-queries-after = "30s"
  max-select-point = 0
  max-select-series = 0
  max-select-buckets = 0

# Retention configuration
[retention]
  enabled = true
  check-interval = "30m0s"

# Shard precreation configuration
[shard-precreation]
  enabled = true
  check-interval = "10m"
  advance-period = "30m"

# Monitor configuration
[monitor]
  store-enabled = true
  store-database = "_internal"
  store-interval = "10s"

# HTTP configuration
[http]
  enabled = true
  bind-address = ":8086"
  auth-enabled = false
  log-enabled = true
  write-tracing = false
  pprof-enabled = true
  pprof-auth-enabled = false
  debug-pprof-enabled = false
  ping-auth-enabled = false
  
  # HTTPS settings (disabled for internal use)
  https-enabled = false
  https-certificate = "/etc/ssl/influxdb.pem"
  https-private-key = "/etc/ssl/influxdb-key.pem"
  
  # Connection limits
  max-connection-limit = 1000
  
  # Request limits optimized for k6 metrics
  max-body-size = "25m"
  max-concurrent-write-limit = 100
  max-enqueued-write-limit = 1000
  enqueued-write-timeout = "30s"
  
  # Response settings
  access-log-path = ""
  access-log-status-filters = []
  
  # CORS settings
  cors-enabled = false
  crlf-enabled = false

# Input plugins configuration
[[influxdb]]
  enabled = true
  bind-address = ":8089"
  database = "k6_metrics"
  retention-policy = "autogen"
  batch-size = 5000
  batch-pending = 10
  read-timeout = "10s"
  typemap = { integer = "int", unsigned = "uint" }

# Graphite configuration (if needed)
[[graphite]]
  enabled = false
  bind-address = ":2003"
  database = "graphite"
  retention-policy = "autogen"
  protocol = "tcp"
  batch-size = 5000
  batch-pending = 10
  batch-timeout = "1s"
  consistency-level = "one"
  separator = "."
  udp-read-buffer = 0

# Collectd configuration (if needed)
[[collectd]]
  enabled = false
  bind-address = ":25826"
  database = "collectd"
  retention-policy = "autogen"
  batch-size = 5000
  batch-pending = 10
  batch-timeout = "10s"
  read-buffer = 0
  typesdb = "/usr/share/collectd/types.db"
  security-level = "none"
  auth-file = "/etc/collectd/auth_file"

# OpenTSDB configuration (if needed)
[[opentsdb]]
  enabled = false
  bind-address = ":4242"
  database = "opentsdb"
  retention-policy = "autogen"
  consistency-level = "one"
  tls-enabled = false
  certificate = "/etc/ssl/influxdb.pem"
  batch-size = 1000
  batch-pending = 5
  batch-timeout = "1s"
  log-point-errors = true

# UDP configuration for high-throughput metrics
[[udp]]
  enabled = false
  bind-address = ":8089"
  database = "k6_metrics"
  retention-policy = "autogen"
  batch-size = 5000
  batch-pending = 10
  batch-timeout = "1s"
  read-buffer = 0
  precision = "ns"

# Continuous queries configuration
[continuous_queries]
  enabled = true
  log-enabled = true
  query-stats-enabled = false
  run-interval = "1s"

# Logging configuration
[logging]
  format = "auto"
  level = "info"
  suppress-logo = false

# Subscriber configuration (for Kapacitor integration)
[subscriber]
  enabled = true
  http-timeout = "30s"
  insecure-skip-verify = false
  ca-certs = ""
  write-concurrency = 40
  write-buffer-size = 1000