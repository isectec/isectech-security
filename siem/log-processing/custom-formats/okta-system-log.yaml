# Okta System Log Format
# Custom format for Okta identity and access management logs

name: "okta_system_log"
pattern: ""
pattern_type: "json"

field_mappings:
  published: "timestamp"
  uuid: "event.id"
  eventType: "event.action"
  displayMessage: "message"
  severity: "event.severity"
  outcome.result: "event.outcome"
  outcome.reason: "event.reason"
  actor.id: "user.id"
  actor.type: "user.type"
  actor.alternateId: "user.email"
  actor.displayName: "user.full_name"
  actor.detail.ipAddress: "source.ip"
  client.userAgent.rawUserAgent: "user_agent.original"
  client.userAgent.os: "user_agent.os.name"
  client.userAgent.browser: "user_agent.name"
  client.device: "host.type"
  client.id: "client.id"
  client.ipAddress: "client.ip"
  client.geographicalContext.city: "source.geo.city_name"
  client.geographicalContext.state: "source.geo.region_name"
  client.geographicalContext.country: "source.geo.country_name"
  client.geographicalContext.postalCode: "source.geo.postal_code"
  client.geographicalContext.geolocation.lat: "source.geo.location.lat"
  client.geographicalContext.geolocation.lon: "source.geo.location.lon"
  target.id: "target.user.id"
  target.type: "target.user.type"
  target.alternateId: "target.user.email"
  target.displayName: "target.user.full_name"
  transaction.id: "transaction.id"
  transaction.type: "transaction.type"
  transaction.detail: "transaction.detail"
  request.ipChain: "network.forwarded_ip"
  authenticationContext.authenticationProvider: "authentication.provider"
  authenticationContext.authenticationStep: "authentication.step"
  authenticationContext.credentialProvider: "authentication.credential_provider"
  authenticationContext.credentialType: "authentication.credential_type"
  authenticationContext.issuer: "authentication.issuer"
  authenticationContext.interface: "authentication.interface"
  authenticationContext.externalSessionId: "authentication.session_id"
  securityContext.asNumber: "network.autonomous_system.number"
  securityContext.asOrg: "network.autonomous_system.organization"
  securityContext.isp: "network.carrier.name"
  securityContext.domain: "dns.question.name"
  securityContext.isProxy: "network.is_proxy"
  debugContext.debugData: "event.debug_data"
  legacyEventType: "event.legacy_type"
  version: "event.api_version"

timestamp_field: "published"
timestamp_format: "iso8601"
severity_field: "severity"
message_field: "displayMessage"
source_field: "actor.alternateId"

preprocessing_rules:
  - "parse_ip_chain"
  - "extract_risk_factors"
  - "normalize_outcome"
  - "enrich_authentication_context"

validation_rules:
  - "require_event_type"
  - "require_actor_id"
  - "validate_timestamp"
  - "validate_ip_addresses"

enabled: true
priority: 30

tags:
  - "okta"
  - "identity"
  - "authentication"
  - "access_management"
  - "sso"
  - "security"
  - "cloud"